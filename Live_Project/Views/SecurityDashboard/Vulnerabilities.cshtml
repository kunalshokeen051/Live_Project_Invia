@model IEnumerable<LP.Models.ViewModels.VulneribilitiesVM>

@{
    ViewData["Title"] = "Vulnerabilities";
}

    <a class="btn mx-2 btn-outline-danger border-none mt-4" asp-action="Index" asp-controller="SecurityDashboard">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house-door-fill" viewBox="0 0 16 16">
            <path d="M6.5 14.5v-3.505c0-.245.25-.495.5-.495h2c.25 0 .5.25.5.5v3.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5Z" />
        </svg>
        Homepage
    </a>

<div class="container">
    <h2 class="my-4 text-center text-uppercase font-weight-bolder">Vulnerabilities</h2>
</div>


<div class="table-responsive">
    <table id="vulnerabilitiesTable" class="table table-responsive-md table-striped table-hover table-bordered">
        <thead>
            <tr>
                <th class="table-danger">Vulnerability Name</th>
                <th class="table-danger">Domain Name</th>
                <th class="table-danger">Vulnerability Description</th>
                <th class="table-danger">Vulnerability Path</th>
                <th class="table-danger">Severity Ranking</th>
                <th class="table-danger">Remediation Info</th>
                <th class="table-danger">Domain IpAddress</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var vulnerability in Model)
            {
                <tr>
                    <td>@vulnerability.VulnerabilityName</td>
                    <td>@vulnerability.DomainName</td>
                    <td>@vulnerability.VulnerabilityDescription</td>
                    <td>@vulnerability.VulnerabilityPath</td>
                    <td class="severity-cell" data-severity="@vulnerability.SeverityRanking">@vulnerability.SeverityRanking</td>
                    <td>@vulnerability.RemediationInfo</td>
                    <td>@vulnerability.DomainIpAddress</td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts
    {
    <script>
        $(document).ready(function () {
            var vulnerabilitiesTable = $('#vulnerabilitiesTable').DataTable({
                "paging": true,
                "ordering": true,
                "searching": true,
                "info": true,
                "responsive": true,
                "columnDefs": [
                    { "orderable": false, "targets": [5] },
                    { "orderable": false, "targets": [6] },
                    { "orderable": false, "targets": [2] }
                ],
                "language": {
                    "emptyTable": "No data available",
                    "infoEmpty": "No records found",
                    "zeroRecords": "No matching records found"
                }
            });


            applySeverityColor();

            vulnerabilitiesTable.on('draw.dt', function () {
                applySeverityColor();
            });

            function applySeverityColor() {
                $('.severity-cell').each(function () {
                    var severity = $(this).data('severity');
                    var color = getSeverityColor(severity);
                    $(this).css('background-color', color);
                });
            }



            function getSeverityColor(severityRanking) {
                if (severityRanking <= 4) {
                    return '#d1ffdf';
                } else if (severityRanking > 4 && severityRanking <= 6) {
                    return '#fffdcc';
                } else {
                    return '#fcb6b1';
                }
            }
        });
    </script>
}
